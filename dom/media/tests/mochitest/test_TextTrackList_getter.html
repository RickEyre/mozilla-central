<!DOCTYPE HTML>
<html>
<!--
https://bugzilla.mozilla.org/show_bug.cgi?id=833386
-->
<head>
	<title>Test for Bug 833386 - HTMLTrackElement</title>
	<script type="text/javascript" src="/MochiKit/MochiKit.js"></script>
	<script type="text/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
	<script type="text/javascript" src="/tests/content/html/content/test/reflect.js"></script>
	<link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css"/>
</head>
<body>
<div id="videoDiv">
</div>
	<pre id="test">
	<script class="testbody" type="text/javascript">
		SimpleTest.waitForExplicitFinish();
		var videoDiv = document.getElementById("videoDiv");
		var WebvttEnabled = undefined;
		// Verify WebVTT support
		try{
	  		WebvttEnabled = SpecialPowers.getBoolPref("media.webvtt.enabled");
		}catch (ex){
			// SpecialPowers failed, perhaps because WebVTT isn't compiled in
			console.log("media.webvtt.enabled pref not found; skipping WebVTT validation");
		}
		if (WebvttEnabled !== undefined) {
		   	// Testing with the pref set to True
		   	SpecialPowers.setBoolPref("media.webvtt.enabled", true);
			var videoElement = document.createElement("video");
			videoElement.src = "/tests/content/media/test/seek.webm";
			videoDiv.appendChild(videoElement);
			var TextTrackList = videoElement.textTracks;
			videoElement.addTextTrack("subtitles", "label", "en-CA");
		   	is(TextTrackList[0].kind, "subtitles", "TextTrackList[0].kind |Pref => True");
			is(TextTrackList[0].label, "label", "TextTrackList[0].label |Pref => True");
			is(TextTrackList[0].language, "en-CA", "TextTrackList[0].language |Pref => True");
			is(TextTrackList[0].mode, "hidden", "TextTrackList[0].mode |Pref => True");
			videoDiv.removeChild(videoElement);
			// Testing with the pref set to False
		   	SpecialPowers.setBoolPref("media.webvtt.enabled", false);
			var videoElement = document.createElement("video");
			videoElement.src = "/tests/content/media/test/seek.webm";
			videoDiv.appendChild(videoElement);
			var TextTrackList = videoElement.textTracks;
			videoElement.addTextTrack("subtitles", "label", "en-CA");
		   	is(TextTrackList[0].kind, "subtitles", "TextTrackList[0].kind |Pref => False");
			is(TextTrackList[0].label, "label", "TextTrackList[0].label |Pref => False");
			is(TextTrackList[0].language, "en-CA", "TextTrackList[0].language |Pref => False");
			is(TextTrackList[0].mode, "hidden", "TextTrackList[0].mode |Pref => False");
			SimpleTest.finish();
		 }else{
			var videoElement = document.createElement("video");
			videoElement.src = "/tests/content/media/test/seek.webm";
			videoDiv.appendChild(videoElement);
			var TextTrackList = videoElement.textTracks;
			videoElement.addTextTrack("subtitles", "label", "en-CA");
		   	is(TextTrackList[0].kind, undefined, "TextTrackList[0].kind |Pref => Undefined");
			is(TextTrackList[0].label, undefined, "TextTrackList[0].label |Pref => Undefined");
			is(TextTrackList[0].language, undefined, "TextTrackList[0].language |Pref => Undefined");
			is(TextTrackList[0].mode, undefined, "TextTrackList[0].mode |Pref => Undefined");
			SimpleTest.finish();
		}
	</script>
	</pre>	
</body>
</html>
